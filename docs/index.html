<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartCharge Dashboard (GO-TO-U Clone - User Version)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- Cài đặt chung & Biến (Theo GO-TO-U) --- */
        :root {
            /* [SỬA] Đổi màu chủ đạo sang Xanh Ngọc (Emerald) */
            --bg-sidebar: #009B77; 
            --bg-main: #F4F7FA;
            --bg-card: #FFFFFF;
            --text-dark: #212529;
            --text-secondary: #6C757D;
            --border-color: #E9ECEF;
            
            /* [MỚI] Biến cho Gradient Xanh Ngọc */
            --gradient-sidebar: linear-gradient(180deg, #009B77 0%, #005C47 100%);

            /* [SỬA] Biến cho Dark Mode (Dễ nhìn hơn - Tông xanh rêu) */
            --dm-bg-sidebar: #005C47;    /* [SỬA] Dark Emerald */
            --dm-bg-main: #1A2C27;      /* [SỬA] Dark Green/Gray */
            --dm-bg-card: #2D483F;      /* [SỬA] Lighter Green/Gray */
            --dm-text-dark: #F7FAFC;
            --dm-text-secondary: #A0AEC0;
            --dm-border-color: #4A685D;    /* [SỬA] Green/Gray for borders */

            /* Màu Trạng thái Phiên sạc */
            --color-completed: #28a745;    /* [SỬA] Giữ màu xanh "thành công" */
            --bg-completed: #E9F8EE;
            --color-planned: #007BFF;     /* Đã đặt (Xanh dương) */
            --bg-planned: #E6F2FF;
            --color-inprogress: #0056b3; /* Đang sạc (Xanh đậm) */
            --bg-inprogress: #CCE5FF;
            --color-noshow: #DC3545;     /* No-Show (Đỏ) */
            --bg-noshow: #F8D7DA;

            /* Màu sắc khác */
            --color-green: #009B77; /* [SỬA] Màu xanh chủ đạo (Emerald) */
            --color-orange: #FD7E14;
            --color-blue: #007BFF;
            --color-yellow: #FFC107;
            --color-teal: #20C997; 
            --color-car-gray: #D0D0D0;
            --color-percent-green: #28a745;
            --color-percent-red: #DC3545;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            margin: 0; padding: 0; background-color: var(--bg-main);
            color: var(--text-dark); display: flex; height: 100vh; overflow: hidden;
            transition: background-color 0.2s, color 0.2s;
        }
        h1, h2, h3, h4, h5 { margin: 0 0 16px 0; font-weight: 600; }
        ul { list-style: none; padding: 0; margin: 0; }
        button { cursor: pointer; font-family: inherit; }

        /* --- Thanh Điều Hướng (Sidebar) --- */
        .sidebar {
            width: 240px; 
            /* [SỬA] Đổi từ màu solid sang gradient */
            background: var(--gradient-sidebar); 
            padding: 24px;
            flex-shrink: 0; height: 100vh; overflow-y: auto; box-sizing: border-box;
            display: flex; flex-direction: column; 
            transition: background-color 0.2s;
        }
        .sidebar .logo {
            font-size: 1.5rem; font-weight: bold; color: var(--bg-card);
            text-align: center; margin-bottom: 32px;
        }
        .sidebar nav { flex-grow: 1; } 
        .sidebar nav li {
            padding: 14px 18px; margin-bottom: 8px; border-radius: 8px; cursor: pointer;
            font-weight: 500; color: rgba(255, 255, 255, 0.8);
            transition: background-color 0.2s, color 0.2s;
            display: flex; align-items: center;
        }
        .sidebar nav li i { margin-right: 12px; width: 20px; text-align: center; }
        .sidebar nav li:hover { background-color: rgba(255, 255, 255, 0.1); color: var(--bg-card); }
        .sidebar nav li.active { 
            background-color: var(--bg-card); 
            /* [SỬA] Dùng biến xanh ngọc */
            color: var(--bg-sidebar); 
            font-weight: bold; 
        }

        /* --- Theme Switcher --- */
        .theme-switcher {
            margin-top: 24px; padding-top: 24px; border-top: 1px solid rgba(255, 255, 255, 0.2);
            display: flex; justify-content: space-around; align-items: center; color: white;
        }
        .theme-switcher .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .theme-switcher .switch input { opacity: 0; width: 0; height: 0; }
        .theme-switcher .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .3s; border-radius: 24px; }
        .theme-switcher .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .3s; border-radius: 50%; }
        .theme-switcher input:checked + .slider { background-color: var(--bg-card); }
        .theme-switcher input:checked + .slider:before { transform: translateX(20px); background-color: var(--color-noshow); }

        /* --- Khu vực Nội dung chính --- */
        .main-content {
            flex-grow: 1; padding: 32px; overflow-y: auto;
            height: 100vh; box-sizing: border-box;
        }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .section-header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 16px; margin-bottom: 24px;
            transition: border-color 0.2s;
        }
        .card {
            background-color: var(--bg-card); border: 1px solid var(--border-color);
            border-radius: 12px; padding: 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;
            transition: background-color 0.2s, border-color 0.2s;
        }
        
        /* --- GIAO DIỆN TAB "DASHBOARD" --- */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card { padding: 20px; }
        .stat-card .label { font-size: 1rem; color: var(--text-secondary); margin-bottom: 8px; display: flex; align-items: center; transition: color 0.2s; }
        .stat-card .label i { margin-right: 8px; font-size: 1.2rem; }
        .stat-card .value { font-size: 2.2rem; font-weight: bold; color: var(--text-dark); transition: color 0.2s; }
        .stat-card .value small { font-size: 1.2rem; color: var(--text-secondary); transition: color 0.2s; }
        .stat-card.co2-card { background-color: var(--color-teal); color: white; }
        .stat-card.co2-card .label, .stat-card.co2-card .value { color: white; }
        
        .charging-header { display: flex; align-items: center; margin-bottom: 20px; }
        .charging-header h3 { margin: 0 20px 0 0; }

        .charger-grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; }
        .charger-card { background-color: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); overflow: hidden; }
        .charger-card-header { padding: 10px 15px; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        .charger-card-header.orange { background-color: var(--color-orange); color: white; }
        .charger-card-header.green { 
            /* [SỬA] Header của "Available" dùng màu xanh lá thành công */
            background-color: var(--color-percent-green); 
            color: white; 
        }
        .charger-card-body { padding: 20px; text-align: center; }
        
        /* --- [XÓA] Visual cũ (car-visual) --- */

        /* [SỬA] CSS cho visual "Sẵn sàng" */
        .available-status { height: 253px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .available-status i { font-size: 3rem; color: var(--color-percent-green); } /* [SỬA] Dùng màu xanh "thành công" */
        .available-status h4 { font-size: 1.2rem; color: var(--color-percent-green); margin: 15px 0 5px 0; } /* [SỬA] Dùng màu xanh "thành công" */
        .available-status p { font-size: 0.9rem; color: var(--text-secondary); margin: 0; }
        
        /* [MỚI] Hình ảnh ô tô SVG đang sạc (Request 2) */
        .charging-visual-svg {
            height: 253px; /* Match height of 'available-status' */
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
            box-sizing: border-box;
        }
        .charging-visual-svg .car-svg-container {
            width: 90%;
            max-width: 200px;
            color: var(--text-secondary); /* Màu của thân xe */
            transition: color 0.2s;
        }
        body.dark-mode .charging-visual-svg .car-svg-container {
             color: var(--dm-text-secondary);
        }
        /* [MỚI] Thêm animation cho cái phích cắm trong SVG */
        .charging-visual-svg .car-svg-container path:last-child {
            color: var(--color-green); /* Màu emerald cho phích cắm */
            animation: pulse 1.5s infinite;
        }
        .charging-visual-svg .charging-stats {
            margin-top: 15px;
            text-align: center;
        }
        .charging-visual-svg .charging-stats h5 {
            font-size: 1rem;
            margin: 0;
            color: var(--text-secondary);
        }
        .charging-visual-svg .charging-stats h3 {
            font-size: 2.5rem; /* [SỬA] Làm % to hơn */
            margin: 0 0 5px 0;
            color: var(--text-dark);
            font-weight: 800;
        }
        .charging-visual-svg .charging-stats h4 {
            font-size: 1.5rem;
            margin: 5px 0;
        }
        .charging-visual-svg .charging-stats h4 small {
            font-size: 1rem;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }

        .charger-card-footer { background-color: #F8F9FA; border-top: 1px solid var(--border-color); padding: 15px; text-align: center; transition: background-color 0.2s, border-color 0.2s; }
        .charger-card-footer h5 { font-size: 1rem; margin: 0 0 4px 0; }
        .charger-card-footer p { font-size: 0.9rem; color: var(--text-secondary); margin: 0; transition: color 0.2s; }
        
        /* --- GIAO DIỆN TAB "LỊCH ĐẶT CHỖ" (Giữ nguyên) --- */
        .schedule-legend { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; }
        .legend-item { display: flex; align-items: center; font-size: 0.9rem; }
        .legend-dot { width: 12px; height: 12px; border-radius: 3px; margin-right: 8px; }
        .schedule-view { display: flex; flex-direction: row; }
        .schedule-timeline-time { width: 80px; flex-shrink: 0; }
        .schedule-timeline-time .time-slot { height: 90px; border-top: 1px dashed var(--border-color); padding-top: 5px; font-size: 0.9rem; color: var(--text-secondary); font-weight: 600; text-align: right; padding-right: 10px; box-sizing: border-box; transition: color 0.2s, border-color 0.2s; }
        .schedule-timeline-time .time-slot:first-child { border-top: none; }
        .schedule-timeline-container { flex-grow: 1; overflow-x: auto; border-left: 2px solid var(--border-color); transition: border-color 0.2s; }
        .schedule-header { display: flex; border-bottom: 2px solid var(--border-color); background-color: #fcfcfc; position: sticky; top: 0; z-index: 10; transition: background-color 0.2s, border-color 0.2s; }
        .schedule-header .charger-column-header { width: 250px; flex-shrink: 0; padding: 16px; border-right: 1px solid var(--border-color); transition: border-color 0.2s; }
        .charger-column-header h5 { margin: 0 0 4px 0; font-size: 1rem; }
        .charger-column-header .charger-id { font-size: 0.85rem; color: var(--text-secondary); transition: color 0.2s; }
        .schedule-body { display: flex; position: relative; }
        .charger-column { width: 250px; flex-shrink: 0; height: calc(90px * 8); border-right: 1px dashed var(--border-color); position: relative; transition: border-color 0.2s; } /* Chiều cao 8 giờ */
        .booking-block { position: absolute; left: 10px; right: 10px; border-radius: 8px; padding: 10px; box-sizing: border-box; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; border-left: 5px solid; margin-bottom: 5px; /* BUFFER TIME */ }
        .booking-car { font-weight: 600; font-size: 0.9rem; margin-bottom: 4px; display: flex; align-items: center; }
        .booking-car i { margin-right: 6px; }
        .booking-details { font-size: 0.85rem; color: var(--text-secondary); margin-left: 20px; }
        .booking-block.status-completed { background-color: var(--bg-completed); border-color: var(--color-completed); color: var(--color-completed); }
        .booking-block.status-planned { background-color: var(--bg-planned); border-color: var(--color-planned); color: var(--color-planned); }
        .booking-block.status-charging { background-color: var(--bg-inprogress); border-color: var(--color-inprogress); color: var(--color-inprogress); }
        .booking-block.status-no-show { background-color: var(--bg-noshow); border-color: var(--color-noshow); color: var(--color-noshow); }
        
        /* --- GIAO DIỆN TAB "PHÂN TÍCH AI" & "DOANH THU" (Statistics) --- */
        .stats-kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; }
        .stats-kpi-card { padding: 20px; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--bg-card); }
        .stats-kpi-card .label { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 8px; }
        .stats-kpi-card .value { font-size: 1.8rem; font-weight: 600; margin-bottom: 8px; }
        .stats-kpi-card .percent-change { font-weight: 600; font-size: 0.9rem; }
        .percent-change.green { color: var(--color-percent-green); }
        .percent-change.red { color: var(--color-percent-red); }
        
        .chart-container { 
            width: 100%; 
            height: 350px; 
            background-color: var(--bg-card); 
            border: 1px solid var(--border-color); 
            border-radius: 8px; 
            padding: 24px; 
            box-sizing: border-box; 
            position: relative; 
            transition: background-color 0.2s, border-color 0.2s;
        }

        /* --- Search Bar --- */
        .search-bar {
            width: 100%;
            padding: 10px 15px;
            margin-bottom: 20px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            box-sizing: border-box;
            font-size: 1rem;
            background-color: var(--bg-card);
            color: var(--text-dark);
            transition: background-color 0.2s, border-color 0.2s, color 0.2s;
        }
        .search-bar::placeholder { color: var(--text-secondary); }

        /* --- Bảng dữ liệu (Dùng cho Quản lý trụ sạc & Doanh thu) --- */
        .data-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .data-table th, .data-table td { padding: 14px; text-align: left; border-bottom: 1px solid var(--border-color); transition: border-color 0.2s; }
        .data-table th { background-color: var(--bg-main); color: var(--text-secondary); font-size: 0.9rem; text-transform: uppercase; transition: background-color 0.2s, color 0.2s; }
        .data-table td { color: var(--text-dark); transition: color 0.2s; }
        .status-dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .status-dot.online { background-color: var(--color-percent-green); }
        .status-dot.offline { background-color: var(--color-percent-red); }
        .btn { padding: 8px 12px; border: none; border-radius: 6px; font-weight: 500; transition: background-color 0.2s; }
        .btn-secondary { background-color: var(--border-color); color: var(--text-dark); }
        .btn-secondary:hover { background-color: #d3d9df; }

        .btn-cancel { background-color: var(--color-noshow); color: white; }
        .btn-cancel:hover { background-color: #b02a37; }


        /* --- MODAL POPUP --- */
        .modal-backdrop { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); }
        .modal-content { background-color: var(--bg-card); margin: 10% auto; width: 90%; max-width: 700px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); animation: fadeIn 0.3s; transition: background-color 0.2s; }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; transition: border-color 0.2s; }
        .modal-header h3 { margin: 0; font-size: 1.5rem; }
        .modal-header .modal-close { font-size: 1.8rem; font-weight: bold; cursor: pointer; color: var(--text-secondary); }
        .modal-tabs { display: flex; padding: 20px 24px 0 24px; }
        .tab-btn { padding: 10px 16px; border: none; background: none; font-size: 1rem; font-weight: 600; color: var(--text-secondary); cursor: pointer; border-bottom: 3px solid transparent; transition: color 0.2s; }
        .tab-btn.active { color: var(--text-dark); border-bottom-color: var(--color-planned); }
        .modal-body { padding: 24px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .info-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        .info-item { text-align: left; }
        .info-item i { font-size: 1.5rem; color: var(--text-secondary); margin-bottom: 12px; }
        .info-item .label { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 4px; }
        .info-item .value { font-size: 1.1rem; font-weight: 600; }
        .speed-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; align-items: center; }
        .speed-stats .info-item { margin-bottom: 20px; }
        .speed-graph-placeholder { height: 200px; background-color: #f0f0f0; border: 1px dashed #ccc; display: grid; place-items: center; color: #999; border-radius: 8px; font-style: italic; transition: background-color 0.2s, border-color 0.2s, color 0.2s; }
        .modal-footer-bar { background-color: var(--bg-main); padding: 16px 24px; border-top: 1px solid var(--border-color); border-radius: 0 0 12px 12px; display: flex; justify-content: space-between; align-items: center; transition: background-color 0.2s, border-color 0.2s; }
        .modal-footer-bar .res-id span { font-weight: 600; color: var(--text-dark); }
        .payment-status { padding: 8px 12px; border-radius: 8px; font-weight: 600; }
        .payment-status.success { background-color: var(--bg-completed); color: var(--color-completed); }
        .payment-status.pending { background-color: var(--bg-noshow); color: var(--color-noshow); }
        @keyframes fadeIn { from {opacity: 0; transform: translateY(-20px);} to {opacity: 1; transform: translateY(0);} }

        /* --- [SỬA] CSS cho Dark Mode (Tông xanh rêu) --- */
        body.dark-mode { background-color: var(--dm-bg-main); color: var(--dm-text-dark); }
        body.dark-mode .sidebar { background: var(--dm-bg-sidebar); } 
        body.dark-mode .sidebar nav li.active { background-color: var(--dm-bg-card); color: var(--dm-text-dark); }
        body.dark-mode .card { background-color: var(--dm-bg-card); border-color: var(--dm-border-color); }
        body.dark-mode .section-header { border-color: var(--dm-border-color); }
        body.dark-mode .stat-card .label, 
        body.dark-mode .stat-card .value small, 
        body.dark-mode .available-status p,
        body.dark-mode .charger-card-footer p,
        body.dark-mode .schedule-timeline-time .time-slot,
        body.dark-mode .charger-column-header .charger-id,
        body.dark-mode .data-table th,
        body.dark-mode .stats-kpi-card .label,
        body.dark-mode .charging-visual-svg .charging-stats h5 { color: var(--dm-text-secondary); } /* [SỬA] Thêm H5 của SVG */
        
        body.dark-mode .stat-card .value,
        body.dark-mode .data-table td,
        body.dark-mode .modal-footer-bar .res-id span,
        body.dark-mode .tab-btn.active,
        body.dark-mode .charging-visual-svg .charging-stats h3 { color: var(--dm-text-dark); } /* [SỬA] Thêm H3 của SVG */
        
        body.dark-mode .charger-card-footer { background-color: var(--dm-bg-card); border-color: var(--dm-border-color); } 
        body.dark-mode .schedule-timeline-container { border-color: var(--dm-border-color); }
        body.dark-mode .schedule-header { background-color: var(--dm-bg-card); border-color: var(--dm-border-color); } 
        body.dark-mode .schedule-header .charger-column-header { border-color: var(--dm-border-color); }
        body.dark-mode .charger-column { border-color: var(--dm-border-color); }
        body.dark-mode .data-table th { background-color: var(--dm-bg-main); }
        body.dark-mode .data-table th, body.dark-mode .data-table td { border-color: var(--dm-border-color); }
        body.dark-mode .btn-secondary { background-color: var(--dm-border-color); color: var(--dm-text-dark); }
        body.dark-mode .btn-secondary:hover { background-color: #4A685D; } 
        body.dark-mode .search-bar { background-color: var(--dm-bg-card); border-color: var(--dm-border-color); color: var(--dm-text-dark); } 
        body.dark-mode .search-bar::placeholder { color: var(--dm-text-secondary); }

        /* Dark Mode - Modal */
        body.dark-mode .modal-content { background-color: var(--dm-bg-card); }
        body.dark-mode .modal-header { border-color: var(--dm-border-color); }
        body.dark-mode .modal-header .modal-close { color: var(--dm-text-secondary); }
        body.dark-mode .tab-btn { color: var(--dm-text-secondary); }
        body.dark-mode .info-item i, body.dark-mode .info-item .label { color: var(--dm-text-secondary); }
        body.dark-mode .speed-graph-placeholder { background-color: var(--dm-bg-main); border-color: var(--dm-border-color); color: var(--dm-text-secondary); } 
        body.dark-mode .modal-footer-bar { background-color: var(--dm-bg-main); border-color: var(--dm-border-color); }


        /* --- RESPONSIVE --- */
        @media (max-width: 768px) {
            body { flex-direction: column; height: auto; overflow-y: auto; }
            .sidebar { width: 100%; height: auto; border-right: none; border-bottom: 1px solid var(--border-color); flex-direction: column; }
            body.dark-mode .sidebar { background: var(--gradient-sidebar); } 
            .sidebar nav { flex-grow: 0; }
            .sidebar nav ul { display: flex; flex-direction: row; overflow-x: auto; padding-bottom: 10px; }
            .sidebar nav li { margin-bottom: 0; margin-right: 8px; flex-shrink: 0; }
            .theme-switcher { display: none; } 
            .main-content { padding: 16px; height: auto; }
            .kpi-grid { grid-template-columns: 1fr 1fr; }
            .charger-grid-container { grid-template-columns: 1fr; }
            .stats-kpi-grid { grid-template-columns: 1fr 1fr; }
            .chart-container { height: 250px; }
            .modal-content { margin: 5% auto; }
            .info-grid { grid-template-columns: 1fr 1fr; }
            .speed-grid { grid-template-columns: 1fr; }
        }

    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="logo">SmartCharge</div>
        <nav>
            <ul id="nav-list">
                <li class="nav-item active" data-target="tong-quan"><i class="fas fa-tachometer-alt"></i> Bảng điều khiển</li>
                <li class="nav-item" data-target="lich-dat-cho"><i class="fas fa-calendar-alt"></i> Lịch đặt chỗ</li>
                <li class="nav-item" data-target="quan-ly-tram"><i class="fas fa-charging-station"></i> Quản lý Trụ sạc</li>
                <li class="nav-item" data-target="phan-tich-ai"><i class="fas fa-brain"></i> Phân tích (AI)</li>
                <li class="nav-item" data-target="doanh-thu"><i class="fas fa-wallet"></i> Doanh thu</li>
            </ul>
        </nav>
        
        <div class="theme-switcher">
            <i class="fas fa-sun"></i>
            <label class="switch">
                <input type="checkbox" id="theme-toggle-checkbox">
                <span class="slider round"></span>
            </label>
            <i class="fas fa-moon"></i>
        </div>
    </aside>

    <main class="main-content">

        <section id="tong-quan" class="content-section active">
            <div class="section-header">
                <h1>Tổng quan Trạm sạc</h1>
            </div>
            
            <div class="kpi-grid">
                 <div class="card stat-card">
                    <div class="label"><i class="fas fa-dollar-sign" style="color: var(--color-percent-green);"></i> Tổng Doanh thu</div>
                    <div class="value">8 342 <small>USD</small></div>
                </div>
                 <div class="card stat-card">
                    <div class="label"><i class="fas fa-bolt" style="color: var(--color-blue);"></i> Tiêu thụ</div>
                    <div class="value">248 <small>kWh</small></div>
                </div>
                 <div class="card stat-card">
                    <div class="label"><i class="fas fa-charging-station" style="color: var(--color-orange);"></i> Số phiên sạc</div>
                    <div class="value">248</div>
                </div>
                 <div class="card stat-card">
                    <div class="label"><i class="fas fa-clock" style="color: var(--text-secondary);"></i> Thời gian sạc</div>
                    <div class="value">24<small>h</small> 2<small>m</small></div>
                </div>
                <div class="card stat-card co2-card">
                    <div class="label"><i class="fas fa-leaf"></i> CO2 đã giảm</div>
                    <div class="value">24 <small>tons</small></div>
                </div>
            </div>
            
            <div class="charging-header">
                <h3>Đang sạc</h3>
            </div>
            <div class="charger-grid-container">
                <div class="charger-card">
                    <div class="charger-card-header orange"><span>1. CCS 1</span><span>120 kW</span></div>
                    <div class="charger-card-body">
                        <div class="charging-visual-svg">
                            <div class="car-svg-container">
                                <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 256 161" preserveAspectRatio="xMidYMid meet"><path fill="currentColor" d="M213.25,80.62H203.7V61.5a2.5,2.5,0,0,0-5,0v19.12h-9.55a2.5,2.5,0,0,0-2.5,2.5v5.37h-11.5V59.61h-16.4V42.12h16.4V36.75h-16.4V24.62H158.8V17a2.5,2.5,0,0,0-5,0v7.62H134.67V17a2.5,2.5,0,0,0-5,0v7.62H110.53V17a2.5,2.5,0,0,0-5,0v7.62H86.4V17a2.5,2.5,0,0,0-5,0v7.62H62.27V17a2.5,2.5,0,0,0-5,0v7.62H38.13V17a2.5,2.5,0,0,0-5,0v7.62H14.12a2.5,2.5,0,0,0-2.5,2.5v89.38a2.5,2.5,0,0,0,2.5,2.5H29v10.38a16.63,16.63,0,0,0,33.25,0V121.5h119.5v10.38a16.63,16.63,0,0,0,33.25,0V121.5h10.25a2.5,2.5,0,0,0,2.5-2.5V83.12A2.5,2.5,0,0,0,213.25,80.62ZM45.62,124a11.63,11.63,0,1,1,11.63-11.62A11.62,11.62,0,0,1,45.62,124Zm136.25,0a11.63,11.63,0,1,1,11.63-11.62A11.62,11.62,0,0,1,181.87,124ZM38.13,36.75h16.4v5.37h-16.4Zm24.14,17.49h16.4v5.37h-16.4Zm0-17.49h16.4v5.37h-16.4Zm24.14,17.49h16.4v5.37h-16.4Zm0-17.49h16.4v5.37h-16.4Zm24.14,17.49h16.4v5.37h-16.4Zm0-17.49h16.4v5.37h-16.4Zm24.14,17.49h16.4v5.37h-16.4Zm24.14,0h16.4v5.37h-16.4Zm-2.5-22.86a2.5,2.5,0,0,0-2.5,2.5v5.37H35.63V36.75a2.5,2.5,0,0,0-2.5-2.5H16.62V29.62H33.13a2.5,2.5,0,0,0,2.5-2.5V24.62H57.27v2.5a2.5,2.5,0,0,0,2.5,2.5h16.4v-5h24.13v5h19.13v-5H144v5h19.13v-5h14.25v2.5a2.5,2.5,0,0,0,2.5,2.5H197V59.61h-24.12V42.12H197v-5.37h16.25v43.87H197V64.61a2.5,2.5,0,0,0-2.5-2.5h-11.5v15.14a2.5,2.5,0,0,0,2.5,2.5h9.55v19.12a2.5,2.5,0,0,0,5,0V83.12h7.05l.13,31.25H197v-10.5a16.58,16.58,0,0,0-6.1-12.4,11.55,11.55,0,0,1-15.15-1.1,16.7,16.7,0,0,0-27-2.78,16.7,16.7,0,0,0-27,2.78,11.55,11.55,0,0,1-15.15,1.1A16.58,16.58,0,0,0,99.5,103.87v10.5H29v-10.5a16.58,16.58,0,0,0-6.1-12.4A11.55,11.55,0,0,1,7.75,89.87a16.7,16.7,0,0,0-2.78-27A16.7,16.7,0,0,0,2.78,35.9,11.55,11.55,0,0,1,1.1,20.75a16.58,16.58,0,0,0,10.5-6.1V29.62h-9v17.49H1.38v2.5H208.4Z"/><path fill="currentColor" d="M255.4,85.24l-23.3-11a2.5,2.5,0,0,0-3.2,3.2l15,7.12v15.25a2.5,2.5,0,0,0,5,0V93.4l6.5,3.08A2.5,2.5,0,1,0,255.4,85.24Z"/></svg>
                            </div>
                            <div class="charging-stats">
                                <h5>Công suất</h5>
                                <h4>120 <small>kW</small></h4>
                                <h3>38%</h3>
                            </div>
                        </div>
                    </div>
                    <div class="charger-card-footer"><h5>Oliver M. (Hyundai Ioniq 5)</h5><p>10:20 AM - 10:40 AM</p></div>
                </div>
                <div class="charger-card">
                    <div class="charger-card-header green"><span>2. Type 1</span><span>11 kW</span></div>
                    <div class="charger-card-body">
                        <div class="available-status"><i class="fas fa-check-circle"></i><h4>Sẵn sàng</h4><p>Lịch sạc kế tiếp<br>lúc 10:50 AM</p></div>
                    </div>
                    <div class="charger-card-footer"><h5>-</h5><p>-</p></div>
                </div>
                <div class="charger-card">
                    <div class="charger-card-header orange"><span>3. CCS 1</span><span>60 kW</span></div>
                    <div class="charger-card-body">
                         <div class="charging-visual-svg">
                            <div class="car-svg-container">
                                <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 256 161" preserveAspectRatio="xMidYMid meet"><path fill="currentColor" d="M213.25,80.62H203.7V61.5a2.5,2.5,0,0,0-5,0v19.12h-9.55a2.5,2.5,0,0,0-2.5,2.5v5.37h-11.5V59.61h-16.4V42.12h16.4V36.75h-16.4V24.62H158.8V17a2.5,2.5,0,0,0-5,0v7.62H134.67V17a2.5,2.5,0,0,0-5,0v7.62H110.53V17a2.5,2.5,0,0,0-5,0v7.62H86.4V17a2.5,2.5,0,0,0-5,0v7.62H62.27V17a2.5,2.5,0,0,0-5,0v7.62H38.13V17a2.5,2.5,0,0,0-5,0v7.62H14.12a2.5,2.5,0,0,0-2.5,2.5v89.38a2.5,2.5,0,0,0,2.5,2.5H29v10.38a16.63,16.63,0,0,0,33.25,0V121.5h119.5v10.38a16.63,16.63,0,0,0,33.25,0V121.5h10.25a2.5,2.5,0,0,0,2.5-2.5V83.12A2.5,2.5,0,0,0,213.25,80.62ZM45.62,124a11.63,11.63,0,1,1,11.63-11.62A11.62,11.62,0,0,1,45.62,124Zm136.25,0a11.63,11.63,0,1,1,11.63-11.62A11.62,11.62,0,0,1,181.87,124ZM38.13,36.75h16.4v5.37h-16.4Zm24.14,17.49h16.4v5.37h-16.4Zm0-17.49h16.4v5.37h-16.4Zm24.14,17.49h16.4v5.37h-16.4Zm0-17.49h16.4v5.37h-16.4Zm24.14,17.49h16.4v5.37h-16.4Zm0-17.49h16.4v5.37h-16.4Zm24.14,17.49h16.4v5.37h-16.4Zm24.14,0h16.4v5.37h-16.4Zm-2.5-22.86a2.5,2.5,0,0,0-2.5,2.5v5.37H35.63V36.75a2.5,2.5,0,0,0-2.5-2.5H16.62V29.62H33.13a2.5,2.5,0,0,0,2.5-2.5V24.62H57.27v2.5a2.5,2.5,0,0,0,2.5,2.5h16.4v-5h24.13v5h19.13v-5H144v5h19.13v-5h14.25v2.5a2.5,2.5,0,0,0,2.5,2.5H197V59.61h-24.12V42.12H197v-5.37h16.25v43.87H197V64.61a2.5,2.5,0,0,0-2.5-2.5h-11.5v15.14a2.5,2.5,0,0,0,2.5,2.5h9.55v19.12a2.5,2.5,0,0,0,5,0V83.12h7.05l.13,31.25H197v-10.5a16.58,16.58,0,0,0-6.1-12.4,11.55,11.55,0,0,1-15.15-1.1,16.7,16.7,0,0,0-27-2.78,16.7,16.7,0,0,0-27,2.78,11.55,11.55,0,0,1-15.15,1.1A16.58,16.58,0,0,0,99.5,103.87v10.5H29v-10.5a16.58,16.58,0,0,0-6.1-12.4A11.55,11.55,0,0,1,7.75,89.87a16.7,16.7,0,0,0-2.78-27A16.7,16.7,0,0,0,2.78,35.9,11.55,11.55,0,0,1,1.1,20.75a16.58,16.58,0,0,0,10.5-6.1V29.62h-9v17.49H1.38v2.5H208.4Z"/><path fill="currentColor" d="M255.4,85.24l-23.3-11a2.5,2.5,0,0,0-3.2,3.2l15,7.12v15.25a2.5,2.5,0,0,0,5,0V93.4l6.5,3.08A2.5,2.5,0,1,0,255.4,85.24Z"/></svg>
                            </div>
                            <div class="charging-stats">
                                <h5>Công suất</h5>
                                <h4>60 <small>kW</small></h4>
                                <h3>45%</h3>
                            </div>
                        </div>
                    </div>
                    <div class="charger-card-footer"><h5>Anna A. (Kia EV6)</h5><p>9:30 AM - 10:40 AM</p></div>
                </div>
                <div class="charger-card">
                    <div class="charger-card-header green"><span>4. CCS 1</span><span>120 kW</span></div>
                    <div class="charger-card-body">
                        <div class="available-status"><i class="fas fa-check-circle"></i><h4>Sẵn sàng</h4><p>Lịch sạc kế tiếp<br>lúc 11:15 AM</p></div>
                    </div>
                    <div class="charger-card-footer"><h5>-</h5><p>-</p></div>
                </div>
            </div>
        </section>

        <section id="lich-dat-cho" class="content-section">
            <div class="section-header">
                <h1>Quản lý Lịch đặt</h1>
            </div>
            
            <div class="schedule-legend">
                <div class="legend-item"><span class="legend-dot" style="background-color: var(--bg-completed); border: 1px solid var(--color-completed);"></span> Hoàn thành</div>
                <div class="legend-item"><span class="legend-dot" style="background-color: var(--bg-planned); border: 1px solid var(--color-planned);"></span> Đã đặt (Chờ)</div>
                <div class="legend-item"><span class="legend-dot" style="background-color: var(--bg-inprogress); border: 1px solid var(--color-inprogress);"></span> Đang sạc</div>
                <div class="legend-item"><span class="legend-dot" style="background-color: var(--bg-noshow); border: 1px solid var(--color-noshow);"></span> No-Show / Hủy</div>
            </div>
            
            <div class="card" style="padding: 0; overflow: hidden;">
                <div class="schedule-view">
                    <div class="schedule-timeline-time">
                        <div class="time-slot" style="height: 60px;"></div> 
                        <div class="time-slot">08:00 AM</div>
                        <div class="time-slot">09:00 AM</div>
                        <div class="time-slot">10:00 AM</div>
                        <div class="time-slot">11:00 AM</div>
                        <div class="time-slot">12:00 PM</div>
                        <div class="time-slot">01:00 PM</div>
                        <div class="time-slot">02:00 PM</div>
                        <div class="time-slot">03:00 PM</div>
                    </div>
                    
                    <div class="schedule-timeline-container">
                        <div class="schedule-header">
                            <div class="charger-column-header"><h5>Trụ 01 (DC 60kW)</h5><div class="charger-id">CND321017</div></div>
                            <div class="charger-column-header"><h5>Trụ 02 (DC 60kW)</h5><div class="charger-id">CND321018</div></div>
                            <div class="charger-column-header"><h5>Trụ 03 (AC 22kW)</h5><div class="charger-id">CND321019</div></div>
                        </div>
                        <div class="schedule-body">
                            <div class="charger-column">
                                <div class="booking-block status-completed" style="top: 30px; height: calc(150px - 5px);"
                                     data-id="200542" data-user="El T." data-time="8:20 AM - 10:00 AM" data-car="Jaguar I-PACE" 
                                     data-kwh="20,008" data-cost="15.7 USD" data-resid="401415" data-payment="Thanh toán thành công" 
                                     data-downtime="1 min / 0,09 USD" data-battery="88%" data-chargeup="+58%" data-peak-power="104 kW" data-avg-power="102.8 kW">
                                    <div class="booking-car"><i class="fas fa-check-circle"></i> Jaguar I-PACE</div>
                                    <div class="booking-details">8:20 AM - 10:00 AM</div>
                                    <div class="booking-details">20,008 kWh</div>
                                </div>
                                <div class="booking-block status-planned" style="top: 270px; height: calc(60px - 5px);"
                                     data-id="200546" data-user="Minh N." data-time="11:00 AM - 11:40 AM" data-car="Hyundai Kona EV" 
                                     data-kwh="-" data-cost="-" data-resid="401419" data-payment="Chờ thanh toán">
                                    <div class="booking-car"><i class="fas fa-calendar-check"></i> Hyundai Kona EV</div>
                                    <div class="booking-details">11:00 AM - 11:40 AM</div>
                                </div>
                                 <div class="booking-block status-planned" style="top: 450px; height: calc(90px - 5px);"
                                     data-id="200549" data-user="Long P." data-time="1:00 PM - 2:00 PM" data-car="Kia EV6" 
                                     data-kwh="-" data-cost="-" data-resid="401422" data-payment="Chờ thanh toán">
                                    <div class="booking-car"><i class="fas fa-calendar-check"></i> Kia EV6</div>
                                    <div class="booking-details">1:00 PM - 2:00 PM</div>
                                </div>
                            </div>
                            
                            <div class="charger-column">
                                <div class="booking-block status-planned" style="top: 90px; height: calc(60px - 5px);"
                                     data-id="200543" data-user="Nguyễn V.A" data-time="9:00 AM - 9:40 AM" data-car="MG ZS EV" 
                                     data-kwh="-" data-cost="-" data-resid="401416" data-payment="Chờ thanh toán">
                                    <div class="booking-car"><i class="fas fa-calendar-check"></i> MG ZS EV</div>
                                    <div class="booking-details">9:00 AM - 9:40 AM</div>
                                </div>
                                <div class="booking-block status-charging" style="top: 225px; height: calc(90px - 5px);"
                                     data-id="200544" data-user="Trần T.B" data-time="10:30 AM - 11:30 AM" data-car="BYD Atto 3" 
                                     data-kwh="15,5 (Đang sạc)" data-cost="-" data-resid="401417" data-payment="Chờ thanh toán" 
                                     data-battery="60%" data-chargeup="+20% (Đang sạc)" data-peak-power="60 kW" data-avg-power="55 kW" data-downtime="0 min">
                                    <div class="booking-car"><i class="fas fa-bolt"></i> BYD Atto 3</div>
                                    <div class="booking-details">10:30 AM - 11:30 AM</div>
                                </div>
                                <div class="booking-block status-completed" style="top: 360px; height: calc(45px - 5px);"
                                     data-id="200547" data-user="Hà P.N" data-time="12:00 PM - 12:30 PM" data-car="Porsche Taycan" 
                                     data-kwh="18,2 kWh" data-cost="12.5 USD" data-resid="401420" data-payment="Thanh toán thành công"
                                     data-downtime="0 min" data-battery="75%" data-chargeup="+30%" data-peak-power="60 kW" data-avg-power="58.1 kW">
                                    <div class="booking-car"><i class="fas fa-check-circle"></i> Porsche Taycan</div>
                                    <div class="booking-details">12:00 PM - 12:30 PM</div>
                                    <div class="booking-details">18,2 kWh</div>
                                </div>
                            </div>
                            
                            <div class="charger-column">
                                 <div class="booking-block status-no-show" style="top: 135px; height: calc(45px - 5px);"
                                     data-id="200545" data-user="Lê V.C" data-time="9:30 AM - 10:00 AM" data-car="Wuling MiniEV" 
                                     data-kwh="0" data-cost="0" data-resid="401418" data-payment="Không tính phí">
                                    <div class="booking-car"><i class="fas fa-times-circle"></i> Wuling MiniEV</div>
                                    <div class="booking-details">9:30 AM - 10:00 AM</div>
                                </div>
                                <div class="booking-block status-charging" style="top: 292.5px; height: calc(135px - 5px);"
                                     data-id="200548" data-user="Chi K.N" data-time="11:15 AM - 12:45 PM" data-car="Omoda E5" 
                                     data-kwh="10.1 (Đang sạc)" data-cost="-" data-resid="401421" data-payment="Chờ thanh toán"
                                     data-battery="55%" data-chargeup="+18% (Đang sạc)" data-peak-power="22 kW" data-avg-power="20.5 kW" data-downtime="1 min">
                                    <div class="booking-car"><i class="fas fa-bolt"></i> Omoda E5</div>
                                    <div class="booking-details">11:15 AM - 12:45 PM</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="quan-ly-tram" class="content-section">
             <div class="section-header">
                <h1>Quản lý Trụ sạc & Giá</h1>
             </div>
             <div class="card">
                <h4 class="card-title">Danh sách Trụ sạc</h4>
                
                <input type="text" id="charger-search" class="search-bar" placeholder="Tìm theo Tên Trụ, Loại sạc hoặc Trạng thái...">
                
                <table class="data-table" id="charger-table">
                    <thead>
                        <tr><th>Tên Trụ</th><th>Loại sạc</th><th>Trạng thái</th><th>Hành động</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Trụ 01</td><td>DC 60kW</td><td><span class="status-dot online"></span> Online</td><td><button class="btn btn-secondary">Quản lý</button></td></tr>
                        <tr><td>Trụ 02</td><td>DC 60kW</td><td><span class="status-dot online"></span> Online</td><td><button class="btn btn-secondary">Quản lý</button></td></tr>
                        <tr><td>Trụ 03</td><td>AC 22kW</td><td><span class="status-dot online"></span> Online</td><td><button class="btn btn-secondary">Quản lý</button></td></tr>
                        <tr><td>Trụ 04</td><td>AC 22kW</td><td><span class="status-dot offline"></span> Offline</td><td><button class="btn btn-secondary">Quản lý</button></td></tr>
                    </tbody>
                </table>
             </div>
             <div class="card">
                <h4 class="card-title">Quản lý giá (Tariffs)</h4>
                 <table class="data-table">
                    <thead>
                        <tr><th>Khung giờ</th><th>Thời gian</th><th>Giá (VNĐ/kWh)</th><th>Hành động</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Giờ Thấp điểm</td><td>00:00 - 07:00</td><td>2.800đ</td><td><button class="btn btn-secondary">Sửa</button></td></tr>
                        <tr><td>Giờ Bình thường</td><td>07:00 - 17:00</td><td>3.500đ</td><td><button class="btn btn-secondary">Sửa</button></td></tr>
                        <tr><td>Giờ Cao điểm</td><td>17:00 - 20:00</td><td>4.200đ</td><td><button class="btn btn-secondary">Sửa</button></td></tr>
                    </tbody>
                 </table>
             </div>
        </section>
        
        <section id="phan-tich-ai" class="content-section">
             <div class="section-header">
                <h1>Phân tích & Thống kê (AI Enhanced)</h1>
             </div>
             <div class="stats-kpi-grid card">
                 <div class="stats-kpi-card">
                     <div class="label">Tiền đã nhận</div>
                     <div class="value">78 909,4 <small>USD</small></div>
                     <div class="percent-change green"><i class="fas fa-arrow-up"></i> 150%</div>
                 </div>
                 <div class="stats-kpi-card">
                     <div class="label">Điện tiêu thụ</div>
                     <div class="value">315 637,6 <small>kWh</small></div>
                     <div class="percent-change green"><i class="fas fa-arrow-up"></i> 120%</div>
                 </div>
                 <div class="stats-kpi-card">
                     <div class="label">Điện đã trả</div>
                     <div class="value">315 637,2 <small>kWh</small></div>
                     <div class="percent-change red"><i class="fas fa-arrow-down"></i> 10%</div>
                 </div>
                 <div class="stats-kpi-card">
                     <div class="label">Điện miễn phí</div>
                     <div class="value">0,4 <small>kWh</small></div>
                     <div class="percent-change green"><i class="fas fa-arrow-up"></i> 10%</div>
                 </div>
                 <div class="stats-kpi-card">
                     <div class="label">Thời gian chờ</div>
                     <div class="value">0,9 <small>USD</small></div>
                     <div class="percent-change green"><i class="fas fa-arrow-up"></i> 1%</div>
                 </div>
             </div>
             <div class="card">
                <h4 style="margin-bottom: 20px;">Doanh thu & Tiêu thụ theo thời gian</h4>
                
                <div class="chart-container">
                    <canvas id="revenueChart"></canvas>
                </div>

             </div>
        </section>

        <section id="doanh-thu" class="content-section">
             <div class="section-header">
                <h1>Lịch sử Doanh thu</h1>
             </div>
              <div class="card">
                 <h4 class="card-title">Giao dịch gần đây</h4>
                 
                 <input type="text" id="revenue-search" class="search-bar" placeholder="Tìm theo ID, User, Trụ sạc...">

                 <table class="data-table" id="revenue-table">
                     <thead>
                         <tr><th>ID Giao dịch</th><th>Ngày</th><th>User</th><th>Trụ sạc</th><th>Số tiền</th></tr>
                     </thead>
                     <tbody>
                         <tr><td>#12345</td><td>19/10/2025 11:00</td><td>Nguyễn Văn A</td><td>Trụ 01</td><td>60.000đ</td></tr>
                         <tr><td>#12343</td><td>19/10/2025 10:30</td><td>Phạm Thị D</td><td>Trụ 03</td><td>45.000đ</td></tr>
                         <tr><td>#12301</td><td>18/10/2025 20:15</td><td>Trần Văn E</td><td>Trụ 01</td><td>55.000đ</td></tr>
                         <tr><td>#12299</td><td>18/10/2025 19:00</td><td>Nguyễn Văn A</td><td>Trụ 02</td><td>70.000đ</td></tr>
                     </tbody>
                 </table>
             </div>
        </section>

    </main>

    <div id="bookingModal" class="modal-backdrop">
        <div class="modal-content">
            <div class="modal-header"><h3>Thông tin Lịch đặt</h3><span class="modal-close" id="modalCloseBtn">&times;</span></div>
            <div class="modal-tabs">
                <button class="tab-btn active" data-tab="info">Thông tin sạc</button>
                <button class="tab-btn" data-tab="speed">Tốc độ sạc</button>
            </div>
            <div id="tab-info" class="modal-body tab-content active">
                <div class="info-grid">
                    <div class="info-item"><i class="fas fa-user-circle"></i><div class="label">ID / User</div><div class="value" id="modal-user">-</div></div>
                    <div class="info-item"><i class="fas fa-clock"></i><div class="label">Thời gian</div><div class="value" id="modal-time">-</div></div>
                    <div class="info-item"><i class="fas fa-hourglass-half"></i><div class="label">Thời gian chờ</div><div class="value" id="modal-downtime">-</div></div>
                    <div class="info-item"><i class="fas fa-battery-three-quarters"></i><div class="label">Dung lượng Pin</div><div class="value" id="modal-battery">-</div></div>
                    <div class="info-item"><i class="fas fa-car"></i><div class="label">Loại xe</div><div class="value" id="modal-car">-</div></div>
                    <div class="info-item"><i class="fas fa-bolt"></i><div class="label">Đã dùng (kWh)</div><div class="value" id="modal-kwh">-</div></div>
                    <div class="info-item"><i class="fas fa-dollar-sign"></i><div class="label">Tổng chi phí</div><div class="value" id="modal-cost">-</div></div>
                     <div class="info-item"><i class="fas fa-battery-full"></i><div class="label">Pin đã sạc</div><div class="value" id="modal-chargeup">-</div></div>
                </div>
            </div>
            <div id="tab-speed" class="modal-body tab-content">
                <div class="speed-grid">
                    <div class="speed-stats">
                        <div class="info-item"><i class="fas fa-bolt" style="color: var(--color-planned)"></i><div class="label">Công suất tối đa (Trụ)</div><div class="value" id="modal-peak-power">-</div></div>
                        <div class="info-item"><i class="fas fa-bolt" style="color: var(--color-completed)"></i><div class="label">Công suất sạc (Xe)</div><div class="value" id="modal-avg-power">-</div></div>
                    </div>
                    <div class="speed-graph-placeholder">[Biểu đồ Tốc độ sạc]</div>
                </div>
            </div>
            <div class="modal-footer-bar">
                <div class="res-id">Mã Lịch đặt: <span id="modal-resid">-</span></div>
                
                <button class="btn btn-cancel" id="modal-cancel-btn" style="display: none;">Hủy Lịch</button>
                
                <div class="payment-status" id="modal-payment">-</div>
            </div>
        </div>
    </div>


    <script>
        // [MỚI] Biến global cho biểu đồ (Tính năng 1)
        let myRevenueChart;

        document.addEventListener('DOMContentLoaded', function() {
            // --- 1. Logic Chuyển Tab (Sidebar) ---
            const navItems = document.querySelectorAll('.nav-item');
            const contentSections = document.querySelectorAll('.content-section');

            function showSection(targetId) {
                contentSections.forEach(section => section.classList.remove('active'));
                navItems.forEach(item => item.classList.remove('active'));
                
                const sectionToShow = document.getElementById(targetId);
                if (sectionToShow) sectionToShow.classList.add('active');
                
                const navItemToActivate = document.querySelector(`.nav-item[data-target="${targetId}"]`);
                if (navItemToActivate) navItemToActivate.classList.add('active');

                // [MỚI] Khởi tạo biểu đồ CHỈ KHI tab 'phan-tich-ai' được kích hoạt (Tính năng 1)
                if (targetId === 'phan-tich-ai' && !myRevenueChart) {
                    initRevenueChart();
                }
            }

            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    showSection(this.dataset.target);
                });
            });

            // Mặc định hiển thị tab 'tong-quan' (Dashboard)
            showSection('tong-quan'); 

            // --- 2. Logic Mở/Đóng Modal (Popup) ---
            const modal = document.getElementById('bookingModal');
            const closeBtn = document.getElementById('modalCloseBtn');
            const bookingBlocks = document.querySelectorAll('.booking-block');
            const cancelBtn = document.getElementById('modal-cancel-btn'); // [MỚI] (Tính năng 4)
            
            const modalData = {
                user: document.getElementById('modal-user'),
                time: document.getElementById('modal-time'),
                downtime: document.getElementById('modal-downtime'),
                battery: document.getElementById('modal-battery'),
                car: document.getElementById('modal-car'),
                kwh: document.getElementById('modal-kwh'),
                cost: document.getElementById('modal-cost'),
                chargeup: document.getElementById('modal-chargeup'),
                resid: document.getElementById('modal-resid'),
                payment: document.getElementById('modal-payment'),
                peakPower: document.getElementById('modal-peak-power'),
                avgPower: document.getElementById('modal-avg-power')
            };

            bookingBlocks.forEach(block => {
                block.addEventListener('click', function() {
                    const data = this.dataset;
                    
                    modalData.user.innerText = `${data.id} / ${data.user}`;
                    modalData.time.innerText = data.time;
                    modalData.downtime.innerText = data.downtime || '-'; // Handle missing data
                    modalData.battery.innerText = data.battery || '-';
                    modalData.car.innerText = data.car;
                    modalData.kwh.innerText = data.kwh;
                    modalData.cost.innerText = data.cost || '-';
                    modalData.chargeup.innerText = data.chargeup || '-';
                    modalData.peakPower.innerText = data.peakPower || '-';
                    modalData.avgPower.innerText = data.avgPower || '-';
                    modalData.resid.innerText = data.resid;
                    
                    // [SỬA] Ngôn ngữ
                    if (data.payment === 'Thanh toán thành công') {
                        modalData.payment.innerText = 'Thanh toán thành công';
                        modalData.payment.className = 'payment-status success';
                    } else if (data.payment === 'Không tính phí') {
                         modalData.payment.innerText = 'Không tính phí';
                         modalData.payment.className = 'payment-status'; // Default style
                    }
                    else {
                        modalData.payment.innerText = data.payment || 'Chờ thanh toán';
                        modalData.payment.className = 'payment-status pending';
                    }

                    // [MỚI] Logic hiển thị nút Hủy (Tính năng 4)
                    if (this.classList.contains('status-planned')) {
                        cancelBtn.style.display = 'block';
                        cancelBtn.dataset.bookingId = data.id; // Lưu ID để biết hủy cái nào
                        modalData.payment.style.display = 'none'; // Ẩn trạng thái payment
                    } else {
                        cancelBtn.style.display = 'none';
                        modalData.payment.style.display = 'block'; // Hiển thị lại trạng thái payment
                    }

                    modal.style.display = 'block';
                    switchModalTab('info'); // Reset về tab info
                });
            });

            closeBtn.onclick = () => modal.style.display = 'none';
            window.onclick = (event) => {
                if (event.target == modal) modal.style.display = 'none';
            }

            // --- 3. Logic Chuyển Tab trong Modal ---
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            function switchModalTab(targetTabId) {
                tabContents.forEach(content => content.classList.remove('active'));
                tabBtns.forEach(btn => btn.classList.remove('active'));
                
                document.getElementById(`tab-${targetTabId}`).classList.add('active');
                document.querySelector(`.tab-btn[data-tab="${targetTabId}"]`).classList.add('active');
            }

            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    switchModalTab(this.dataset.tab);
                });
            });

            // --- [MỚI] 4. Logic Dark/Light Mode (Tính năng 2) ---
            const themeToggle = document.getElementById('theme-toggle-checkbox');
            themeToggle.addEventListener('change', function() {
                const isDarkMode = this.checked;
                document.body.classList.toggle('dark-mode', isDarkMode);

                // Cập nhật màu cho biểu đồ (Tính năng 1)
                if (myRevenueChart) {
                    const newTickColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                    const newLabelColor = isDarkMode ? '#A0AEC0' : '#6C757D'; 
                    
                    myRevenueChart.options.scales.x.ticks.color = newLabelColor;
                    myRevenueChart.options.scales.y.ticks.color = newLabelColor;
                    myRevenueChart.options.scales.x.grid.color = newTickColor;
                    myRevenueChart.options.scales.y.grid.color = newTickColor;
                    myRevenueChart.options.plugins.legend.labels.color = newLabelColor;
                    myRevenueChart.update();
                }
            });

            // --- [MỚI] 5. Logic Biểu đồ Chart.js (Tính năng 1) ---
            function initRevenueChart() {
                if (document.getElementById('revenueChart')) {
                    const ctx = document.getElementById('revenueChart').getContext('2d');
                    
                    const isDarkMode = document.body.classList.contains('dark-mode');
                    const tickColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                    const labelColor = isDarkMode ? '#A0AEC0' : '#6C757D'; 

                    const chartData = {
                        labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
                        datasets: [
                            {
                                label: 'Doanh thu (USD)',
                                data: [1200, 1900, 3000, 5000, 2300, 3100, 4200, 3500, 4800, 5500, 6000, 8342],
                                /* [SỬA] Đổi màu biểu đồ sang xanh ngọc */
                                backgroundColor: 'var(--color-green)', 
                                borderColor: 'var(--color-green)',
                                borderWidth: 1,
                                borderRadius: 5,
                            },
                            {
                                label: 'Tiêu thụ (kWh)',
                                data: [800, 1200, 2000, 3500, 1500, 2100, 2800, 2300, 3200, 3800, 4100, 5200],
                                backgroundColor: 'var(--color-yellow)',
                                borderColor: 'var(--color-yellow)',
                                borderWidth: 1,
                                borderRadius: 5,
                            }
                        ]
                    };

                    myRevenueChart = new Chart(ctx, {
                        type: 'bar',
                        data: chartData,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: { color: labelColor }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: { color: tickColor },
                                    ticks: { color: labelColor }
                                },
                                x: {
                                    grid: { color: tickColor },
                                    ticks: { color: labelColor }
                                }
                            }
                        }
                    });
                }
            }

            // --- [MỚI] 6. Logic Tìm kiếm Bảng (Tính năng 3) ---
            function setupTableFilter(inputId, tableSelector) {
                const searchInput = document.getElementById(inputId);
                if (!searchInput) return;

                searchInput.addEventListener('keyup', function() {
                    const filter = this.value.toUpperCase();
                    const rows = document.querySelectorAll(tableSelector + ' tbody tr');
                    
                    rows.forEach(row => {
                        const rowText = row.textContent.toUpperCase();
                        row.style.display = rowText.indexOf(filter) > -1 ? '' : 'none';
                    });
                });
            }
            
            setupTableFilter('charger-search', '#charger-table');
            setupTableFilter('revenue-search', '#revenue-table');

            // --- [MỚI] 7. Logic Hủy Lịch (Tính năng 4) ---
            cancelBtn.addEventListener('click', function() {
                const bookingId = this.dataset.bookingId;
                if (!bookingId) return;
                
                // Tìm khối lịch đặt tương ứng trong giao diện
                const blockToCancel = document.querySelector(`.booking-block[data-id="${bookingId}"]`);
                
                if (blockToCancel && confirm(`Bạn có chắc muốn hủy lịch đặt #${bookingId} không?`)) {
                    // 1. Cập nhật giao diện khối: đổi sang 'no-show'
                    blockToCancel.className = 'booking-block status-no-show';
                    blockToCancel.querySelector('.booking-car i').className = 'fas fa-times-circle';
                    
                    // 2. Cập nhật data-payment (để lần sau mở modal cho đúng)
                    blockToCancel.dataset.payment = 'Không tính phí';
                    
                    // 3. Đóng modal
                    modal.style.display = 'none';
                }
            });

        });
    </script>
</body>
</html>
